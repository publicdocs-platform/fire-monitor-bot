- const friendlyDate = (d) => new Date(d).toLocaleString('en-US', {timeZone:'UTC', hour12:true, year: 'numeric', day: 'numeric', month: 'short', day: 'numeric', hour: 'numeric', minute: 'numeric', timeZoneName: 'short'});
- const mapData = Object.assign({}, {cities: data.cities ? data.cities.all : []}, data.mapData || {});
- const numFormat = new Intl.NumberFormat('en-US', {maximumFractionDigits: 2});
- const pctFormat = new Intl.NumberFormat('en-US', {maximumFractionDigits: 0});
doctype html
html.perim
    head
        meta(charset="UTF-8")
        link(rel="stylesheet",href="https://cdn.rawgit.com/openlayers/openlayers.github.io/master/en/v5.3.0/css/ol.css",integrity="sha384-C7SzZySesoxngSK5V0BaD1DUap0LPZGWZpnXQGoIwvBXFc8G21y4s1QYvyr84FNa",crossorigin="anonymous")

        script(src='https://code.jquery.com/jquery-3.4.1.min.js',
               integrity="sha384-vk5WoKIaW/vJyUAd9n/wmopsmNhiy+L2Z+SBxGYnUkunIxVxAv/UtMOhba/xskxh",crossorigin="anonymous")

        script(src="https://cdn.rawgit.com/openlayers/openlayers.github.io/master/en/v5.3.0/build/ol.js",
               integrity="sha384-iQkGyyH4ioz3m+maM3s9MX1Oq67mACa4B9Z3ovUv3Sv37LJ96fx3WnZfLoiC3Wfl",
               crossorigin="anonymous")

        script
            include ../node_modules/ol-helpers/index.js
        script
            include ../node_modules/qrcode/build/qrcode.min.js
        script
            include ../client/renderMap.js
        style
            include style.css


    body
        div.content
            div.warn
                div.warn-icon
                    include ../imgs/warning.svg
                div.warn-content
                    | DO NOT USE FOR HEALTH, SAFETY, EMERGENCY, or EVACUATION PURPOSES. Consult local public officials instead.
                    br
                    | Info is APPROXIMATE, often INCORRECT and OUT-OF-DATE, NOT REAL-TIME, and NOT REVIEWED BY A HUMAN BEING.
                    br
                    | Unofficial. For information only. USE AT YOUR OWN RISK â€” DANGER MAY BE CLOSER AND LARGER THAN SHOWN HERE
            div.warn
                if (data.current ? (data.current.NFSAType || '') : '').includes('Emerging')
                    div.innerWarn
                        | This is an emerging report - details may be especially uncertain.
                div.cite
                    b 
                        | To the maximum extent permitted by law: (1) all content is provided to you on an "AS IS" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, WHETHER EXPRESS, IMPLIED, STATUTORY, OR OTHER (INCLUDING, WITHOUT LIMITATION, ANY WARRANTIES OR CONDNTIONS OF TITLE, MERCHANTABILITY, FITNESS FOR A PARTICULAR PURPOSE, OR NONINFRINGEMENT); and (2) IN NO EVENT WILL ANY AUTHOR OR DATA PROVIDER BE LIABLE TO YOU ON ANY LEGAL THEORY (INCLUDING, WITHOUT LIMITATION, NEGLIGENCE) OR OTHERWISE FOR ANY DIRECT, SPECIAL, INDIRECT, INCIDENTAL, CONSEQUENTIAL, PUNITIVE, EXEMPLARY, OR OTHER LOSSES, COSTS, EXPENSES, OR DAMAGES arising out of your use of this content, even if the author or data provider has been advised of the possibility of such losses, costs, expenses, or damages.
                    | &nbsp;Not affiliated with or endorsed by any government agencies.
                    br
                    | Generated by twitter.com/@#{config.twitterName} using #{config.systemName} v#{config.version}.
                    | No claim to original government works.
                    | Sources may be modified or combined with other data.
                    br
                    | Open original image for full resolution.
                    | EPSG:3857.
                    | #{data.uniqueUpdateId}
            div#map(class='map bigMap',style='position:relative;')
                div.mapTitle
                    h1
                        if data.current
                            span #{data.current.Final_Fire_Name}
                        else
                            span #{data.title}
                        - const usePerimAcres = data.current.PerimDateTime && data.current.PerimeterData.Acres;
                        - const rawAcres = usePerimAcres ? data.current.PerimeterData.Acres : data.current.DailyAcres;
                        - const acres = rawAcres >= 100 ? Math.round(rawAcres) : rawAcres;
                        if data.perimDateTime
                            if usePerimAcres
                                span &nbsp;#{numFormat.format(acres)} perim. acres
                                .perimDate @#{friendlyDate(data.perimDateTime)} (entire event not shown; satellite data not current)
                            else
                                .perimDate Perimeter @#{friendlyDate(data.perimDateTime)} (entire event not shown; satellite data not current)
                            if data.current.PerimeterData.Acres && data.current.DailyAcres
                                - const delta = 100.0 * data.current.DailyAcres / data.current.PerimeterData.Acres - 100.0;
                                if delta >= 1
                                    .perimDate Fire may be at least #{pctFormat.format(Math.ceil(delta))}% larger than area enclosed in perimeter below
                        else
                            .perimDate General Vicinity (entire event not shown; satellite data not current)
                        each st in (data.subtitle || [])
                            .detailSubtitle
                                | #{st}
            canvas#qrcode        
        script
            | showMap(#{data.lon}, #{data.lat}, #{data.zoom}, 'perim', !{JSON.stringify(mapData)}, '#{data.current.Source}');

        
